---
type NavItem = { label: string; href: string };
type Social = { label: string; href: string; icon: string; ariaLabel?: string };
type FooterLink = { label: string; href: string };

type FooterSections = {
  linksTitle: string;
  socialTitle: string;
  locationEyebrow: string;
  locationTitle: string;
  locationSubtitle: string;
  locationHoursLabel?: string;
};

type FooterMap = {
  loadTitle: string;
  loadSubtitle: string;
  loadCta: string;
  loadAriaLabel: string;
  ctaLabel: string;
  ctaAriaLabel: string;
  iframeTitle: string;
};

type Props = {
  brand: { name: string; tagline?: string };
  contact: {
    phone: string;
    email: string;
    whatsapp: string;
    address: string;
    hours: string;
    emergency?: string;
    mapLink?: string;
    mapEmbed?: string;
  };
  nav: NavItem[];
  footer: {
    brandLabel?: string;
    description: string;
    links: FooterLink[];
    social: Social[];
    legal: string;
    sections: FooterSections;
    map: FooterMap;
    hoursLabel: string;
    bottomNote: string;
  };
};

const { brand, contact, nav = [], footer } = Astro.props as Props;
const mapEmbedSrc = contact.mapEmbed ?? "";
const mapCtaLink = contact.mapLink ?? "";
const mapIframeTitle = footer.map.iframeTitle;
const brandLabel = footer.brandLabel ?? brand.name;
const locationHoursLabel = footer.sections.locationHoursLabel ?? footer.hoursLabel ?? "Horario";
---

<footer id="contacto" class="bg-[rgba(32,32,32,0.92)] text-white">
  <div
    class="container-wide grid gap-12 py-14 lg:grid-cols-[1.1fr_0.9fr] lg:py-20"
  >
    <div class="space-y-8">
      <div class="space-y-4">
        <p class="text-xs uppercase tracking-[0.36em] text-(--champagne)">
          {brandLabel}
        </p>
        <h3 class="text-4xl font-normal">{brand.tagline}</h3>
        <p class="text-base leading-relaxed text-white/70">
          {footer.description}
        </p>
      </div>

      <div class="grid gap-6 sm:grid-cols-2">
        <div class="space-y-3">
          <p class="text-sm font-semibold text-white/90">{footer.sections.linksTitle}</p>
          <div class="grid grid-cols-2 gap-2 text-sm text-white/70">
            {
              nav.map((item) => (
                <a class="hover:text-white" href={item.href}>
                  {item.label}
                </a>
              ))
            }
            {
              footer.links.map((item) => (
                <a class="hover:text-white" href={item.href}>
                  {item.label}
                </a>
              ))
            }
          </div>
        </div>
        <div class="space-y-3">
          <p class="text-sm font-semibold text-white/90">{footer.sections.socialTitle}</p>
          <div class="flex flex-wrap gap-3">
            {
              footer.social.map((item) => (
                <a
                  class="inline-flex items-center justify-center gap-2 rounded-full border border-white/20 bg-white/5 px-4 py-2 text-sm font-semibold text-white/90 transition hover:border-white hover:text-white focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-(--champagne)"
                  href={item.href}
                  aria-label={item.ariaLabel ?? item.label}
                  target="_blank"
                  rel="noreferrer"
                >
                  {item.icon === "instagram" ? (
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.6"
                    >
                      <rect x="4" y="4" width="16" height="16" rx="5" ry="5" />
                      <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0" />
                      <circle cx="17" cy="7" r="0.9" fill="currentColor" />
                    </svg>
                  ) : (
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-5 w-5"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                    >
                      <path d="M13.4 10.5V8.9c0-.8.2-1.2 1.3-1.2H16V5h-2.1c-2.5 0-3.5 1.1-3.5 3.2v2.3H9v2.8h1.5V20h2.9v-6.7H16l.3-2.8h-2.9z" />
                    </svg>
                  )}
                  <span class="sr-only">{item.label}</span>
                </a>
              ))
            }
          </div>
        </div>
      </div>
    </div>

    <div class="space-y-6">
      <div id="ubicacion" class="space-y-3">
        <div class="flex flex-wrap items-baseline gap-x-4 gap-y-1">
          <div>
            <p
              class="text-[11px] font-semibold uppercase tracking-[0.24em] text-(--champagne)"
            >
              {footer.sections.locationEyebrow}
            </p>
            <h4 class="text-2xl font-semibold">{footer.sections.locationTitle}</h4>
            <p class="text-sm text-white/70">{footer.sections.locationSubtitle}</p>
          </div>
          <div class="rounded-full bg-white/5 px-3 py-1 text-xs font-semibold text-white/75 ring-1 ring-white/15">
            {locationHoursLabel}
          </div>
        </div>
        <div
          class="rounded-2xl border border-white/15 bg-white/5 p-3 shadow-[0_18px_45px_rgba(0,0,0,0.24)] backdrop-blur-sm"
        >
          <div
            data-map-container
            class="relative aspect-16/10 overflow-hidden rounded-[18px] border border-white/20 bg-linear-to-br from-white/12 via-white/10 to-[rgba(201,181,151,0.12)] shadow-inner"
          >
            <div
              class="absolute inset-0 flex flex-col items-center justify-center gap-3 text-center text-white/80"
            >
              <div
                class="flex h-14 w-14 items-center justify-center rounded-full bg-white/12 ring-1 ring-white/25 backdrop-blur-[3px]"
                aria-hidden="true"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-6 w-6"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.8"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M12 21s6-4.35 6-10a6 6 0 10-12 0c0 5.65 6 10 6 10z"
                  ></path>
                  <circle cx="12" cy="11" r="2.5"></circle>
                </svg>
              </div>
              <div class="space-y-1">
                <p class="text-base font-semibold text-white">
                  {footer.map.loadTitle}
                </p>
                <p class="text-sm text-white/70">
                  {footer.map.loadSubtitle}
                </p>
              </div>
              <button
                type="button"
                data-map-load
                class="inline-flex items-center gap-2 rounded-full bg-white px-4 py-2 text-sm font-semibold text-(--charcoal) shadow-[0_10px_30px_rgba(0,0,0,0.18)] ring-1 ring-white/40 transition hover:-translate-y-px hover:shadow-[0_16px_40px_rgba(0,0,0,0.24)] focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-(--champagne)"
                aria-label={footer.map.loadAriaLabel}
              >
                {footer.map.loadCta}
              </button>
            </div>
          </div>
          <div class="mt-3 flex flex-wrap items-start justify-between gap-3">
            <div class="space-y-2 text-sm text-white/75">
              <p class="text-white/90">{contact.address}</p>
              <div class="space-y-0.5">
                <p class="text-[11px] uppercase tracking-[0.14em] text-white/65 font-semibold">{locationHoursLabel}</p>
                <p class="text-white/65 leading-relaxed whitespace-pre-line">
                  {contact.hours}
                </p>
              </div>
            </div>
            <a
              href={mapCtaLink}
              class="inline-flex items-center gap-2 rounded-full border border-white/30 px-4 py-2 text-sm font-semibold text-white/90 transition hover:border-white hover:text-white focus-visible:outline focus-visible:outline-offset-2 focus-visible:outline-(--champagne)"
              aria-label={footer.map.ctaAriaLabel}
              target="_blank"
              rel="noreferrer"
            >
              {footer.map.ctaLabel}
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="gold-divider opacity-50"></div>
  <div
    class="container-wide flex flex-col gap-2 py-5 text-xs text-white/60 sm:flex-row sm:items-center sm:justify-between"
  >
    <p>{footer.legal}</p>
    <p>{footer.bottomNote}</p>
  </div>
</footer>

<script define:vars={{ mapEmbedSrc, mapIframeTitle }}>
  const MAP_EMBED_SRC = mapEmbedSrc;
  const MAP_IFRAME_TITLE = mapIframeTitle;
  const mapContainer = document.querySelector("[data-map-container]");
  const loadBtn = document.querySelector("[data-map-load]");
  let mapLoaded = false;

  const loadMap = () => {
    if (!mapContainer || mapLoaded || !MAP_EMBED_SRC) return;
    mapLoaded = true;
    const iframe = document.createElement("iframe");
    iframe.src = MAP_EMBED_SRC;
    iframe.title = MAP_IFRAME_TITLE;
    iframe.setAttribute("aria-label", MAP_IFRAME_TITLE);
    iframe.loading = "lazy";
    iframe.referrerPolicy = "no-referrer-when-downgrade";
    iframe.className = "h-full w-full";
    iframe.allowFullscreen = true;
    iframe.style.border = "0";
    iframe.style.position = "absolute";
    iframe.style.inset = "0";
    mapContainer.innerHTML = "";
    mapContainer.appendChild(iframe);
  };

  loadBtn?.addEventListener("click", loadMap);
</script>
