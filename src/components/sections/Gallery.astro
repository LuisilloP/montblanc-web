---
type Item = { title: string; image: string; alt: string };
type Props = { data: { title: string; note: string; items: Item[] } };

const { data } = Astro.props as Props;
---

<section id="antes-despues" class="container-wide space-y-8 py-16 lg:space-y-12 lg:py-24">
  <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
    <div class="space-y-2">
      <p class="pill w-fit text-[11px] tracking-[0.2em]">Antes y después</p>
      <h2 class="text-4xl leading-tight sm:text-5xl">{data.title}</h2>
      <p class="text-lg leading-relaxed text-[var(--charcoal)]/70 sm:text-xl">{data.note}</p>
    </div>
    <div class="rounded-full border border-[rgba(176,128,80,0.2)] bg-white/80 px-4 py-2 text-sm text-[var(--charcoal)]/70">
      Resultados de referencia · Solicita tu plan personalizado
    </div>
  </div>

  <div class="grid gap-6 md:grid-cols-2">
    {data.items.map((item, index) => (
      <button
        type="button"
        data-gallery-trigger
        data-index={index}
        class="group relative overflow-hidden rounded-3xl border border-[rgba(176,128,80,0.18)] bg-white/60 shadow-md transition hover:-translate-y-1 hover:shadow-xl focus:outline-none"
        aria-label={`Ver detalle de ${item.title}`}
      >
        <img
          src={item.image}
          alt={item.alt}
          loading="lazy"
          decoding="async"
          class="h-full w-full object-cover"
          style="aspect-ratio: 4 / 3;"
        />
        <div class="pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[rgba(32,32,32,0.55)] opacity-80 transition group-hover:opacity-90" />
        <div class="absolute bottom-4 left-4 right-4 flex items-center justify-between text-white">
          <div>
            <p class="text-sm uppercase tracking-[0.18em] text-[rgba(255,255,255,0.85)]">Caso</p>
            <p class="text-lg font-semibold">{item.title}</p>
          </div>
          <span class="flex h-10 w-10 items-center justify-center rounded-full bg-white/15 ring-1 ring-white/30">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
          </span>
        </div>
      </button>
    ))}
  </div>

  <div
    data-gallery-modal
    data-items={JSON.stringify(data.items)}
    class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 px-4 py-10 backdrop-blur-sm"
    role="dialog"
    aria-modal="true"
    aria-label="Galería antes y después"
  >
    <div class="relative w-full max-w-4xl rounded-3xl bg-[var(--ivory)] p-3 shadow-[0_25px_80px_rgba(0,0,0,0.35)]">
      <button
        type="button"
        data-gallery-close
        class="absolute right-4 top-4 rounded-full bg-white/90 p-2 text-[var(--charcoal)] shadow-sm ring-1 ring-[rgba(176,128,80,0.2)]"
        aria-label="Cerrar galería"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
      <img
        data-gallery-image
        src={data.items[0]?.image}
        alt={data.items[0]?.alt}
        class="h-full w-full rounded-2xl object-cover"
        loading="lazy"
        decoding="async"
        style="aspect-ratio: 16 / 10;"
      />
      <div class="mt-3 flex items-center justify-between px-2 pb-1">
        <div>
          <p class="text-xs uppercase tracking-[0.14em] text-[var(--goldLight)]">Caso</p>
          <p class="text-base font-semibold text-[var(--charcoal)]" data-gallery-title>{data.items[0]?.title}</p>
        </div>
        <p class="text-sm text-[var(--charcoal)]/65">Imágenes referenciales listas para reemplazar</p>
      </div>
    </div>
  </div>

  <script>
    const modal = document.querySelector("[data-gallery-modal]");
    const modalImage = modal?.querySelector("[data-gallery-image]");
    const modalTitle = modal?.querySelector("[data-gallery-title]");
    const closeButton = modal?.querySelector("[data-gallery-close]");
    const triggers = Array.from(document.querySelectorAll("[data-gallery-trigger]"));
    const galleryItems = modal?.dataset.items ? JSON.parse(modal.dataset.items) : [];

    const closeModal = () => {
      modal?.classList.add("hidden");
      document.body.style.overflow = "";
    };

    const openModal = (index) => {
      const selected = galleryItems[index];
      if (!selected || !modalImage || !modalTitle) return;
      modalImage.src = selected.image;
      modalImage.alt = selected.alt;
      modalTitle.textContent = selected.title;
      modal?.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    };

    modal?.addEventListener("click", (event) => {
      if (event.target === modal) closeModal();
    });

    closeButton?.addEventListener("click", closeModal);
    window.addEventListener("keydown", (event) => {
      if (event.key === "Escape") closeModal();
    });
    triggers.forEach((trigger) => {
      trigger.addEventListener("click", () => {
        const index = Number(trigger.getAttribute("data-index"));
        openModal(index);
      });
    });
  </script>
</section>
