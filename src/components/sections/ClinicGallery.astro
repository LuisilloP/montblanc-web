---
const gallery = [
  { src: "/clinic/recepcion.jpg", alt: "Recepción con lounge iluminado", title: "Recepción & lounge" },
  { src: "/clinic/box1.jpg", alt: "Box dental con equipamiento de alta tecnología", title: "Box principal" },
  { src: "/clinic/sala-espera.jpg", alt: "Sala de espera con tonos beige y sillas cómodas", title: "Sala de espera" },
  { src: "/clinic/pasillo.jpg", alt: "Pasillo con iluminación cálida y detalles en dorado", title: "Pasillo central" },
  { src: "/clinic/box2.jpg", alt: "Box de procedimientos estéticos", title: "Box estética" },
  { src: "/clinic/equipamiento.jpg", alt: "Equipamiento odontológico de última generación", title: "Equipamiento" },
  { src: "/clinic/esterilizacion.jpg", alt: "Área de esterilización", title: "Esterilización" },
  { src: "/clinic/detalle.jpg", alt: "Detalle decorativo en tonos champagne", title: "Detalle decorativo" }
];
---

<section id="galeria-clinica" class="relative overflow-hidden py-16 lg:py-24" data-reveal>
  <div class="pointer-events-none absolute inset-0 opacity-80">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_18%_18%,rgba(255,255,255,0.6),transparent_32%),radial-gradient(circle_at_80%_12%,rgba(230,214,198,0.55),transparent_30%),var(--bg-noise)]" />
  </div>

  <div class="container-wide relative space-y-10">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="space-y-2">
        <p class="text-[11px] font-semibold uppercase tracking-[0.24em] text-[var(--goldLight)]">Galería</p>
        <h2 class="text-3xl font-semibold text-[var(--charcoal)] sm:text-4xl">Conoce nuestra clínica</h2>
        <p class="text-base text-[var(--charcoal)]/70 sm:text-lg">Espacios pensados para tu comodidad y confianza.</p>
      </div>
      <div class="flex flex-wrap gap-3">
        <a
          href="https://wa.me/56900000000"
          class="inline-flex items-center gap-2 rounded-full bg-white px-4 py-2 text-sm font-semibold text-[var(--charcoal)] shadow-[0_10px_35px_rgba(32,32,32,0.08)] ring-1 ring-[rgba(32,32,32,0.06)] transition hover:-translate-y-[1px] hover:shadow-[0_14px_40px_rgba(32,32,32,0.12)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--goldLight)]"
          target="_blank"
          rel="noreferrer"
        >
          Agendar por WhatsApp
        </a>
        <a
          href="#ubicacion"
          class="inline-flex items-center gap-2 rounded-full border border-[rgba(32,32,32,0.08)] bg-white/80 px-4 py-2 text-sm font-semibold text-[var(--charcoal)] shadow-sm backdrop-blur-[2px] transition hover:-translate-y-[1px] hover:shadow-[0_12px_32px_rgba(32,32,32,0.12)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--goldLight)]"
        >
          Ver ubicación
        </a>
      </div>
    </div>

    <div class="grid gap-5 sm:gap-6 md:grid-cols-2 lg:grid-cols-3">
      {gallery.map((item, index) => (
        <button
          type="button"
          class={`group relative overflow-hidden rounded-2xl border border-white/40 bg-white/80 shadow-[0_18px_45px_rgba(0,0,0,0.08)] backdrop-blur-[2px] transition duration-200 ease-out hover:-translate-y-1 hover:shadow-[0_24px_60px_rgba(0,0,0,0.12)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--goldLight)] reveal-on-scroll ${
            index === 0 ? "lg:col-span-2 lg:row-span-2" : ""
          }`}
          data-reveal
          data-reveal-delay={`${index * 120}ms`}
          data-gallery-card
          data-index={index}
          aria-label={`Abrir imagen: ${item.title}`}
        >
          <img
            src={item.src}
            alt={item.alt}
            loading="lazy"
            decoding="async"
            width="1280"
            height="900"
            sizes="(min-width: 1024px) 33vw, (min-width: 768px) 50vw, 100vw"
            class="h-full w-full object-cover transition duration-300 ease-out group-hover:scale-[1.02]"
            style={index === 0 ? "aspect-ratio: 4 / 3;" : "aspect-ratio: 4 / 3;"}
          />
          <div class="pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-[rgba(18,18,18,0.35)] transition group-hover:to-[rgba(18,18,18,0.45)]" />
          <div class="pointer-events-none absolute inset-x-4 bottom-4 flex items-center justify-between text-white">
            <div class="space-y-1">
              <p class="text-xs uppercase tracking-[0.18em] text-white/80">Ambiente</p>
              <p class="text-lg font-semibold drop-shadow-[0_6px_24px_rgba(0,0,0,0.35)]">{item.title}</p>
            </div>
            <span class="flex h-10 w-10 items-center justify-center rounded-full bg-white/20 ring-1 ring-white/30 backdrop-blur-[2px]">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
              </svg>
            </span>
          </div>
        </button>
      ))}
    </div>
  </div>

    <div
      data-gallery-modal
      data-gallery-items={JSON.stringify(gallery)}
      class="fixed inset-0 z-50 hidden items-center justify-center bg-[rgba(10,10,10,0.58)] px-4 py-10 backdrop-blur-sm"
      role="dialog"
      aria-modal="true"
      aria-label="Galería de la clínica"
    >
    <div class="relative w-full max-w-5xl rounded-3xl bg-[var(--ivory)]/98 p-4 shadow-[0_28px_80px_rgba(0,0,0,0.35)]">
      <div class="flex items-center justify-between gap-4 px-1 pb-3">
        <div class="space-y-1">
          <p class="text-[11px] uppercase tracking-[0.2em] text-[var(--goldLight)]">Ambiente</p>
          <p class="text-lg font-semibold text-[var(--charcoal)]" data-gallery-title></p>
        </div>
        <div class="flex items-center gap-2">
          <button
            type="button"
            data-gallery-prev
            class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-[rgba(32,32,32,0.08)] bg-white/90 text-[var(--charcoal)] shadow-sm transition hover:-translate-y-[1px] hover:shadow-lg focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--goldLight)]"
            aria-label="Imagen anterior"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <button
            type="button"
            data-gallery-next
            class="inline-flex h-10 w-10 items-center justify-center rounded-full border border-[rgba(32,32,32,0.08)] bg-white/90 text-[var(--charcoal)] shadow-sm transition hover:-translate-y-[1px] hover:shadow-lg focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--goldLight)]"
            aria-label="Imagen siguiente"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
            </svg>
          </button>
          <button
            type="button"
            data-gallery-close
            class="inline-flex h-10 w-10 items-center justify-center rounded-full bg-[rgba(32,32,32,0.08)] text-[var(--charcoal)] shadow-inner ring-1 ring-[rgba(32,32,32,0.08)] transition hover:scale-[1.02] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--goldLight)]"
            aria-label="Cerrar galería"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      <div class="relative overflow-hidden rounded-2xl border border-[rgba(32,32,32,0.08)] bg-white/90">
        <img
          data-gallery-image
          src={gallery[0].src}
          alt={gallery[0].alt}
          loading="lazy"
          decoding="async"
          class="h-full w-full object-cover"
          width="1600"
          height="1000"
          style="aspect-ratio: 16 / 10;"
        />
      </div>
      <p class="mt-3 px-1 text-sm text-[var(--charcoal)]/70">Imágenes referenciales listas para reemplazar por tus fotos reales.</p>
    </div>
  </div>
</section>

<script>
  const modal = document.querySelector("[data-gallery-modal]");
  const galleryItems = modal?.dataset.galleryItems ? JSON.parse(modal.dataset.galleryItems) : [];
  const cards = Array.from(document.querySelectorAll("[data-gallery-card]"));
  const modalImg = modal?.querySelector("[data-gallery-image]");
  const modalTitle = modal?.querySelector("[data-gallery-title]");
  const btnClose = modal?.querySelector("[data-gallery-close]");
  const btnPrev = modal?.querySelector("[data-gallery-prev]");
  const btnNext = modal?.querySelector("[data-gallery-next]");
  let currentIndex = 0;
  let lastFocused = null;

  const focusableSelectors = 'button, [href], [tabindex]:not([tabindex="-1"])';

  const lockScroll = () => {
    const scrollBarComp = window.innerWidth - document.documentElement.clientWidth;
    document.body.dataset.scrollY = String(window.scrollY);
    document.body.style.top = `-${window.scrollY}px`;
    document.body.style.position = "fixed";
    document.body.style.width = "100%";
    document.body.style.paddingRight = scrollBarComp ? `${scrollBarComp}px` : "";
  };

  const unlockScroll = () => {
    const y = Number(document.body.dataset.scrollY || "0");
    document.body.style.position = "";
    document.body.style.top = "";
    document.body.style.paddingRight = "";
    document.body.style.width = "";
    window.scrollTo(0, y);
    document.body.removeAttribute("data-scroll-y");
  };

  const setModalVisibility = (show) => {
    if (!modal) return;
    modal.classList.toggle("hidden", !show);
    if (show) {
      lockScroll();
      (btnClose ?? modal).focus();
      modal.setAttribute("aria-hidden", "false");
    } else {
      unlockScroll();
      modal.setAttribute("aria-hidden", "true");
      lastFocused?.focus?.();
    }
  };

  const renderSlide = (idx) => {
    if (!modalImg || !modalTitle) return;
    const item = galleryItems[idx];
    if (!item) return;
    currentIndex = idx;
    modalImg.src = item.src;
    modalImg.alt = item.alt;
    modalTitle.textContent = item.title;
  };

  const openModal = (idx) => {
    lastFocused = document.activeElement;
    renderSlide(idx);
    setModalVisibility(true);
  };

  const closeModal = () => setModalVisibility(false);

  const nextSlide = () => {
    const next = (currentIndex + 1) % galleryItems.length;
    renderSlide(next);
  };
  const prevSlide = () => {
    const prev = (currentIndex - 1 + galleryItems.length) % galleryItems.length;
    renderSlide(prev);
  };

  const onKeydown = (event) => {
    if (modal?.classList.contains("hidden")) return;
    if (event.key === "Escape") {
      event.preventDefault();
      closeModal();
    } else if (event.key === "ArrowRight") {
      event.preventDefault();
      nextSlide();
    } else if (event.key === "ArrowLeft") {
      event.preventDefault();
      prevSlide();
    } else if (event.key === "Tab") {
      const focusables = modal.querySelectorAll(focusableSelectors);
      if (!focusables.length) return;
      const first = focusables[0];
      const last = focusables[focusables.length - 1];
      if (event.shiftKey && document.activeElement === first) {
        event.preventDefault();
        last.focus();
      } else if (!event.shiftKey && document.activeElement === last) {
        event.preventDefault();
        first.focus();
      }
    }
  };

  cards.forEach((card) => {
    card.addEventListener("click", () => {
      const idx = Number(card.getAttribute("data-index")) || 0;
      openModal(idx);
    });
  });

  btnClose?.addEventListener("click", closeModal);
  btnNext?.addEventListener("click", nextSlide);
  btnPrev?.addEventListener("click", prevSlide);

  modal?.addEventListener("click", (event) => {
    if (event.target === modal) closeModal();
  });
  document.addEventListener("keydown", onKeydown);
</script>
