---
import { Icon } from 'astro-icon/components';

type NavItem = { label: string; href: string };
type Labels = {
  homeAria: string;
  navPrimary: string;
  menuOpen: string;
  menuClose: string;
  navMobile: string;
  menuLabel: string;
};

type Props = {
  brand: { name: string; tagline?: string; logo?: string };
  nav: NavItem[];
  labels: Labels;
};

const { brand, nav = [], labels } = Astro.props as Props;
const logoSrc = brand.logo ?? "/mont_logo.png";
---

<header data-header class="site-header fixed inset-x-0 top-0 z-50 pt-3 sm:pt-4">
  <div class="container-wide">
    <div
      data-nav-shell
      class="nav-shell relative mt-1 flex items-center gap-3 rounded-[26px] border border-[rgba(180,171,159,0.24)] bg-[rgba(248,240,232,0.72)] px-3 py-2.5 shadow-[0_18px_60px_rgba(32,32,32,0.06)] backdrop-blur-xl backdrop-saturate-150 transition-all duration-300 md:gap-4 md:px-4 lg:px-6 lg:py-3"
    >
      <a
        href="#inicio"
        class="group flex items-center gap-3 rounded-full px-1.5 py-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-(--goldLight) focus-visible:ring-offset-2 focus-visible:ring-offset-[rgba(248,240,232,0.6)]"
        aria-label={labels.homeAria}
      >
        <div
          class="logo-mark flex h-10 w-10 items-center justify-center overflow-hidden rounded-full border border-[rgba(32,32,32,0.08)] bg-white/80 shadow-[0_6px_16px_rgba(32,32,32,0.08)] md:h-11 md:w-11"
        >
          <img
            src={logoSrc}
            alt={brand.name}
            width="853"
            height="653"
            loading="eager"
            decoding="async"
            class="h-8 w-auto object-contain transition-transform duration-300 group-hover:scale-[1.02] group-focus-visible:scale-[1.02] md:h-9"
            onerror="this.classList.add('hidden'); this.nextElementSibling?.classList.remove('hidden');"
          />
          <span class="logo-fallback hidden text-[11px] font-semibold tracking-[0.32em] text-(--charcoal)">
            {brand.name}
          </span>
        </div>
        <div class="flex flex-col gap-0.5 leading-tight">
          <span class="text-[12px] font-semibold uppercase tracking-[0.26em] text-(--charcoal)/85 md:text-[13px]">
            {brand.name}
          </span>
          {brand.tagline && (
            <span class="text-[11px] md:text-[12px] text-[rgba(32,32,32,0.7)]">
              {brand.tagline}
            </span>
          )}
        </div>

      </a>

      <nav
        class="desktop-nav hidden flex-1 items-center justify-center gap-1 md:flex"
        aria-label={labels.navPrimary}
      >
        {nav.map((item) => (
          <a class="nav-link" href={item.href}>{item.label}</a>
        ))}
      </nav>

      <div class="flex flex-1 items-center justify-end gap-2 md:flex-none md:gap-3">

        <button
          type="button"
          data-menu-button
          class="inline-flex h-11 w-11 items-center justify-center rounded-full border border-[rgba(32,32,32,0.12)] bg-white/80 text-(--charcoal) shadow-[0_8px_20px_rgba(32,32,32,0.08)] transition hover:border-[rgba(32,32,32,0.2)] hover:bg-[rgba(248,232,224,0.8)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-(--goldLight) focus-visible:ring-offset-2 focus-visible:ring-offset-[rgba(248,240,232,0.6)] md:hidden"
          aria-label={labels.menuOpen}
          aria-expanded="false"
        >
          <span class="sr-only">{labels.menuOpen}</span>
          <Icon name="lucide:menu" class="h-5 w-5" stroke-width="1.6" />
        </button>
      </div>
    </div>
  </div>

  <div
    data-mobile-overlay
    aria-hidden="true"
    class="mobile-overlay pointer-events-none fixed inset-0 z-40 flex items-start justify-center px-4 pb-10 pt-24 opacity-0 transition-opacity duration-200 md:hidden"
  >
    <div
      data-overlay-backdrop
      class="absolute inset-0 bg-[rgba(12,8,4,0.38)] backdrop-blur-sm transition-opacity duration-200"
    ></div>
    <div
      data-mobile-panel
      tabindex="-1"
      role="dialog"
      aria-modal="true"
      aria-label={labels.menuLabel}
      class="relative z-10 w-full max-w-xl rounded-[28px] border border-[rgba(176,171,159,0.24)] bg-[rgba(248,232,224,0.98)] px-5 py-5 shadow-[0_22px_70px_rgba(32,32,32,0.18)] transition-all duration-200 ease-out"
    >
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <div class="logo-mark flex h-9 w-9 items-center justify-center overflow-hidden rounded-full border border-[rgba(32,32,32,0.08)] bg-white/85 shadow-[0_6px_16px_rgba(32,32,32,0.08)]">
            <img
              src={logoSrc}
              alt={brand.name}
              width="853"
              height="653"
              loading="eager"
              decoding="async"
              class="h-7 w-auto object-contain"
              onerror="this.classList.add('hidden'); this.nextElementSibling?.classList.remove('hidden');"
            />
            <span class="logo-fallback hidden text-[11px] font-semibold tracking-[0.32em] text-(--charcoal)">
              {brand.name}
            </span>
          </div>
          <div class="flex flex-col gap-0.5 leading-tight">
            <span class="text-[12px] font-semibold uppercase tracking-[0.24em] text-(--charcoal)/85">
              {brand.name}
            </span>
            {brand.tagline && (
              <span class="text-[11px] text-[rgba(32,32,32,0.7)]">
                {brand.tagline}
              </span>
            )}
          </div>
        </div>
        <button
          type="button"
          data-menu-close
          class="flex h-11 w-11 items-center justify-center rounded-full border border-[rgba(32,32,32,0.12)] bg-white/80 text-(--charcoal) shadow-[0_8px_20px_rgba(32,32,32,0.08)] transition hover:border-[rgba(32,32,32,0.2)] hover:bg-[rgba(248,232,224,0.9)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-(--goldLight) focus-visible:ring-offset-2 focus-visible:ring-offset-[rgba(248,240,232,0.7)]"
          aria-label={labels.menuClose}
        >
          <span class="sr-only">{labels.menuClose}</span>
          <Icon name="lucide:x" class="h-5 w-5" stroke-width="1.6" />
        </button>
      </div>

      <nav
        class="mt-4 flex flex-col divide-y divide-[rgba(32,32,32,0.06)]"
        aria-label={labels.navMobile}
      >
        {nav.map((item) => (
          <a
            class="block py-3 text-lg font-semibold tracking-[0.02em] text-(--charcoal)/90 transition hover:text-(--goldLight) focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-(--goldLight) focus-visible:ring-offset-4 focus-visible:ring-offset-[rgba(248,232,224,0.9)]"
            href={item.href}
          >
            {item.label}
          </a>
        ))}
      </nav>


    </div>
  </div>

  <style>
    .nav-link {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      padding: 0.65rem 0.9rem;
      border-radius: 999px;
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.01em;
      color: rgba(32, 32, 32, 0.78);
      transition: all 200ms ease;
    }

    .nav-link::after {
      content: "";
      position: absolute;
      left: 16px;
      right: 16px;
      bottom: 10px;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(176, 128, 80, 0.7), transparent);
      opacity: 0;
      transform: translateY(4px);
      transition: all 200ms ease;
    }

    .nav-link:hover,
    .nav-link:focus-visible {
      color: var(--charcoal);
      background: rgba(230, 214, 198, 0.45);
    }

    .nav-link:hover::after,
    .nav-link:focus-visible::after {
      opacity: 1;
      transform: translateY(0);
    }

    .site-header.is-scrolled .nav-shell {
      background: rgba(248, 240, 232, 0.92);
      border-color: rgba(180, 171, 159, 0.36);
      box-shadow: 0 22px 70px rgba(32, 32, 32, 0.12);
    }

    .mobile-overlay [data-overlay-backdrop],
    .mobile-overlay [data-mobile-panel] {
      opacity: 0;
      transform: translateY(8px);
    }

    .mobile-overlay.is-open {
      pointer-events: auto;
      opacity: 1;
    }

    .mobile-overlay.is-open [data-overlay-backdrop] {
      opacity: 1;
      transform: translateY(0);
    }

    .mobile-overlay.is-open [data-mobile-panel] {
      opacity: 1;
      transform: translateY(0);
    }

    @media (prefers-reduced-motion: reduce) {
      .nav-link,
      .mobile-overlay,
      .mobile-overlay [data-mobile-panel],
      .mobile-overlay [data-overlay-backdrop] {
        transition: none !important;
      }
    }
  </style>

  <script type="module" src="/scripts/navbar.js"></script>
</header>
